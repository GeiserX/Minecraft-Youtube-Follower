services:
  minecraft-spectator-bot:
    image: drumsergio/minecraft-spectator-bot:0.1.0
    container_name: minecraft-spectator-bot
    environment:
      - MINECRAFT_USERNAME=${MINECRAFT_USERNAME}
      - SERVER_HOST=${SERVER_HOST:-your_server_ip}
      - SERVER_PORT=${SERVER_PORT:-25565}
      - SPECTATOR_PORT=${SPECTATOR_PORT:-3000}
      - AUTH_CACHE_DIR=/app/config/.auth
      - AZURE_CLIENT_ID=${AZURE_CLIENT_ID}
    volumes:
      - ./bot/config:/app/config
      - ./bot/logs:/app/logs
    restart: unless-stopped
    networks:
      - minecraft-streaming

  streaming-service:
    image: drumsergio/minecraft-streaming-service:0.1.0
    container_name: minecraft-streaming-service
    # Intel iGPU passthrough (Linux only, comment out on Windows)
    # devices:
    #   - /dev/dri:/dev/dri
    environment:
      - YOUTUBE_STREAM_KEY=${YOUTUBE_STREAM_KEY}
      - TWITCH_STREAM_KEY=${TWITCH_STREAM_KEY}
      - STREAM_PLATFORM=${STREAM_PLATFORM:-youtube}
      - DISPLAY_WIDTH=${DISPLAY_WIDTH:-1920}
      - DISPLAY_HEIGHT=${DISPLAY_HEIGHT:-1080}
      - SPECTATOR_URL=http://minecraft-spectator-bot:3000
      - MUMBLE_SERVER=minecraft-mumble-server
      - MUMBLE_PORT=64738
      - VOICE_VOLUME_GAIN=${VOICE_VOLUME_GAIN:-2.0}
      - GAME_MUSIC_VOLUME_GAIN=${GAME_MUSIC_VOLUME_GAIN:-0.5}
    volumes:
      - ./streaming/config:/app/config
      - ./streaming/logs:/app/logs
    depends_on:
      - minecraft-spectator-bot
      - mumble-server
    restart: unless-stopped
    networks:
      - minecraft-streaming

  mumble-server:
    image: mumblevoip/mumble-server:latest
    container_name: minecraft-mumble-server
    ports:
      - "${MUMBLE_PORT:-64738}:64738/tcp"
      - "${MUMBLE_PORT:-64738}:64738/udp"
    environment:
      - MUMBLE_SUPERUSER_PASSWORD=${MUMBLE_SUPERUSER_PASSWORD:-changeme}
    volumes:
      - ./mumble/config:/data
    restart: unless-stopped
    networks:
      - minecraft-streaming

networks:
  minecraft-streaming:
    driver: bridge

